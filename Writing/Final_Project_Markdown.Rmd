---
title: "Final_Project_Markdown"
author: "Human Epi 2"
date: "11/7/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Packages used in the final project
```{r, Packages needed}
library(dplyr)
library(stringr)
library(tidyselect)
library(ggplot2)
library(rmarkdown)
library(RColorBrewer)
library(knitr)
library(forcats)
library(readr)
library(tidyr)
library(broom)
library(purrr)
library(scales)
library(lubridate)
library(viridis)
library(RColorBrewer)
library(scales)
library(tidyverse)
library(sf)
library(tigris)
library(shiny)
```

## Uploading California weather datasets 

Datasets were downloaded from CDC Wonder for the years 2006 to 2011 (from January 1st to December 31st)

[CDC Wonder](https://wonder.cdc.gov/)

#West Niles Data:

```{r upload WNV data}
report <-  read_csv( "../Data/wnv_human_cases.csv")
```

Change week to date

```{r clean WNV data}

a <- report %>%
  filter(Year == "2006") 
a <- a %>% 
  mutate(date = lubridate::ymd( "2006-01-01" ) + lubridate::weeks(a$`Week Reported` - 1 ))
b <- report %>%
  filter(Year == "2007")
b <- b %>% 
  mutate(date = lubridate::ymd( "2007-01-01" ) + lubridate::weeks(b$`Week Reported` - 1 ))
c <- report %>%
  filter(Year == "2008")
c <- c %>% 
  mutate(date = lubridate::ymd( "2008-01-01" ) + lubridate::weeks(c$`Week Reported` - 1 ))
d <- report %>%
  filter(Year == "2009")
d <- d %>% 
  mutate(date = lubridate::ymd( "2009-01-01" ) + lubridate::weeks(d$`Week Reported` - 1 ))
e <- report %>%
  filter(Year == "2010")
e <- e %>% 
  mutate(date = lubridate::ymd( "2010-01-01" ) + lubridate::weeks(e$`Week Reported` - 1 ))

ab <- merge(a,b, all = TRUE)
abc <- merge(ab, c, all = TRUE)
abcd <- merge(abc, d, all = TRUE)
abcde <- merge(abcd, e, all = TRUE)
```

```{r Collapse WNV data by month}
cases <- abcde %>% 
  select(date, 
         county = County, 
         positive_cases = "Positive Cases") %>% 
  mutate(date = ymd(date)) %>% 
  mutate(date = floor_date(date, unit = "month")) %>% 
  group_by(date, county) %>% 
  summarize(positive_cases = sum(positive_cases)) %>% 
  ungroup

cases   
```

#Temperature and precipitation data: 

1. Uploading datasets

```{r uploading datasets}
temp_2006 <- read_csv("../Data/temp/temp_2006.csv")
temp_2007 <- read_csv("../Data/temp/temp_2007.csv")
temp_2008 <- read_csv("../Data/temp/temp_2008.csv")
temp_2009 <- read_csv("../Data/temp/temp_2009.csv")
temp_2010 <- read_csv("../Data/temp/temp_2010.csv")
temp_2011 <- read_csv("../Data/temp/temp_2011.csv")
precip_2006 <- read_csv("../Data/precip/precip_2006.csv")
precip_2007 <- read_csv("../Data/precip/precip_2007.csv")
precip_2008 <- read_csv("../Data/precip/precip_2008.csv")
precip_2009 <- read_csv("../Data/precip/precip_2009.csv")
precip_2010 <- read_csv("../Data/precip/precip_2010.csv")

```

2. Creating a dataframe with air temperature (Â°F) information of California for the years 2006 to 2011.

```{r, binding temperature datasets (2006-2010)}

temp <- rbind(temp_2006, temp_2007, temp_2008, temp_2009, 
              temp_2010)

temp <- temp %>% 
  select(County, "County Code", "Month Day, Year Code", "Day of Year", 
         "Avg Daily Max Air Temperature (F)", 
         "Avg Daily Min Air Temperature (F)") %>% 
  rename(county = County,
         fip = "County Code",
         date = "Month Day, Year Code",
         day_year = "Day of Year",
         max_temp_f = "Avg Daily Max Air Temperature (F)",
         min_temp_f = "Avg Daily Min Air Temperature (F)") %>% 
  mutate(date = mdy(date))
head(temp)
tail(temp)
```

3. Creating a dataframe with the precipitation (mm) information of California for the years 2006 to 2010.

```{r, binding precipitation datasets (2006-2011)}

precip <- rbind(precip_2006, precip_2007, precip_2008, precip_2009, 
              precip_2010)

precip <- precip %>%
  select(County, "Month Day, Year Code", "Avg Daily Precipitation (mm)")%>%
  rename(county = County,
         date = "Month Day, Year Code",
         avg_precip = "Avg Daily Precipitation (mm)") %>% 
  mutate(date = mdy(date))

head(precip)
tail(precip)
```

4. Merging temperature and precipitation of CA by date and county to have just one main dataframe with weather conditions for the years 2006 to 2011.

```{r, merging precipitations and temperature}

ca_weather <- merge(temp, precip, by = c("county", "date"))
head(ca_weather)
tail(ca_weather)

```

```{r clean precipitation data}

ca_precip <- ca_weather %>% 
  select(county, date, fip, avg_precip) %>% 
  separate(county, c("county", "state"), sep = " County, CA") %>% 
  select(county, date, fip, avg_precip) %>% 
  mutate(date = floor_date(date, unit = "month")) %>% 
  group_by(county, fip, date) %>% 
  summarise(avg_precip = mean(avg_precip)) %>% 
  ungroup %>% 
  arrange(date)

head(ca_precip)

```

#Merge datasets

```{r merge datasets}

ca_precip_cases <- full_join(ca_precip, cases, by = c('date', 'county')) 

ca_precip_cases <- ca_precip_cases %>% 
  mutate(positive_cases = ifelse(!is.na(positive_cases), positive_cases, 0))

ca_precip_cases <- ca_precip_cases %>% 
  arrange(positive_cases) %>% 
  rename(fips = fip)

head(ca_precip_cases)
```


